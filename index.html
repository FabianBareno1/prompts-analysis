<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Angular Audit</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/zero-md@3?register"></script>
    <link rel="stylesheet" href="./app-theme.css" />
  </head>
  <body>
    <div class="header-nav-row">
      <header>Angular Audit</header>
      <nav aria-label="Analysis sections">
        <button id="unit-testing" class="active" aria-label="View Unit Testing analysis" aria-pressed="true" role="tab">Unit Testing</button>
        <button id="security-posture" aria-label="View Security Posture analysis" aria-pressed="false" role="tab">Security Posture</button>
        <button id="regression-risk" aria-label="View Regression Risk analysis" aria-pressed="false" role="tab">Regression Risk</button>
        <button id="semantic-bug-detection" aria-label="View Semantic Bug Detection analysis" aria-pressed="false" role="tab">Semantic Bug Detection</button>
      </nav>
    </div>
    <main>
      <div id="summary-md-container">
        <zero-md id="summary-md" style="display: block" src="">
          <template>
            <link rel="stylesheet" href="./app-theme.css" />
          </template>
        </zero-md>
      </div>
      <div class="chart-area" id="chart-area">
        <div id="file-upload-area">
          <div class="file-upload-group" id="unit-testing-upload" style="display: none; align-items: center; gap: 0.3rem">
            <label for="unit-testing-file" style="font-size: 0.98rem; color: #60a5fa; font-weight: 500; margin-bottom: 0;">CSV Unit Testing:</label>
            <input type="file" id="unit-testing-file" accept=".csv" aria-label="Upload CSV for Unit Testing" style="display:none;" />
            <button type="button" class="file-upload-btn" onclick="document.getElementById('unit-testing-file').click()" aria-label="Select CSV for Unit Testing">
              <span class="file-upload-icon" aria-hidden="true">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;">
                  <rect x="3" y="14" width="14" height="3" rx="1.5" fill="#374151"/>
                  <path d="M10 14V5" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M7 8l3-3 3 3" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span> <span id="unit-testing-file-label">Upload a File</span>
            </button>
            <button id="unit-testing-advanced-btn" class="advanced-btn" aria-label="Show advanced chart options for Unit Testing" tabindex="0">Advanced options</button>
            <select id="unit-testing-chart-type" aria-label="Chart type for Unit Testing" style="display: none;"></select>
          </div>
          <div class="file-upload-group" id="security-posture-upload" style="display: none; align-items: center; gap: 0.3rem">
            <label for="security-posture-file" style="font-size: 0.98rem; color: #60a5fa; font-weight: 500; margin-bottom: 0;">CSV Security Posture:</label>
            <input type="file" id="security-posture-file" accept=".csv" aria-label="Upload CSV for Security Posture" style="display:none;" />
            <button type="button" class="file-upload-btn" onclick="document.getElementById('security-posture-file').click()" aria-label="Select CSV for Security Posture">
              <span class="file-upload-icon" aria-hidden="true">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;">
                  <rect x="3" y="14" width="14" height="3" rx="1.5" fill="#374151"/>
                  <path d="M10 14V5" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M7 8l3-3 3 3" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span> <span id="security-posture-file-label">Upload a File</span>
            </button>
            <button id="security-posture-advanced-btn" class="advanced-btn" aria-label="Show advanced chart options for Security Posture" tabindex="0">Advanced options</button>
            <select id="security-posture-chart-type" aria-label="Chart type for Security Posture" style="display: none;"></select>
          </div>
          <div class="file-upload-group" id="regression-risk-upload" style="display: none; align-items: center; gap: 0.3rem">
            <label for="regression-risk-file" style="font-size: 0.98rem; color: #60a5fa; font-weight: 500; margin-bottom: 0;">CSV Regression Risk:</label>
            <input type="file" id="regression-risk-file" accept=".csv" aria-label="Upload CSV for Regression Risk" style="display:none;" />
            <button type="button" class="file-upload-btn" onclick="document.getElementById('regression-risk-file').click()" aria-label="Select CSV for Regression Risk">
              <span class="file-upload-icon" aria-hidden="true">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;">
                  <rect x="3" y="14" width="14" height="3" rx="1.5" fill="#374151"/>
                  <path d="M10 14V5" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M7 8l3-3 3 3" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span> <span id="regression-risk-file-label">Upload a File</span>
            </button>
            <button id="regression-risk-advanced-btn" class="advanced-btn" aria-label="Show advanced chart options for Regression Risk" tabindex="0">Advanced options</button>
            <select id="regression-risk-chart-type" aria-label="Chart type for Regression Risk" style="display: none;"></select>
          </div>
          <div class="file-upload-group" id="semantic-bug-detection-upload" style="display: none; align-items: center; gap: 0.3rem">
            <label for="semantic-bug-detection-file" style="font-size: 0.98rem; color: #60a5fa; font-weight: 500; margin-bottom: 0;">CSV Semantic Bug Detection:</label>
            <input type="file" id="semantic-bug-detection-file" accept=".csv" aria-label="Upload CSV for Semantic Bug Detection" style="display:none;" />
            <button type="button" class="file-upload-btn" onclick="document.getElementById('semantic-bug-detection-file').click()" aria-label="Select CSV for Semantic Bug Detection">
              <span class="file-upload-icon" aria-hidden="true">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle;">
                  <rect x="3" y="14" width="14" height="3" rx="1.5" fill="#374151"/>
                  <path d="M10 14V5" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M7 8l3-3 3 3" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span> <span id="semantic-bug-detection-file-label">Upload a File</span>
            </button>
            <button id="semantic-bug-detection-advanced-btn" class="advanced-btn" aria-label="Show advanced chart options for Semantic Bug Detection" tabindex="0">Advanced options</button>
            <select id="semantic-bug-detection-chart-type" aria-label="Chart type for Semantic Bug Detection" style="display: none;"></select>
          </div>
        </div>
        <svg id="chart" style="width: 100%; height: 100%; position: static; z-index: 1" role="img" aria-label="Data chart"></svg>
        <div id="heatmap-container" style="width: 100%; height: 400px; display: none;"></div>
        <div class="loader" id="loader" aria-live="polite" aria-label="Loading data"></div>
        <div id="csv-summary" style="display: none; position: absolute; top: 70px; left: 50%; transform: translateX(-50%); background: #222; color: #fff; padding: 1rem 1.5rem; border-radius: 0.7rem; z-index: 300; box-shadow: 0 2px 12px #0008; font-size: 1.05rem;"></div>
        <div class="error-message" id="error-message" aria-live="polite" hidden></div>
      </div>
    </main>
        <script>
          function updateFileLabel(inputId, labelId) {
            const input = document.getElementById(inputId);
            const label = document.getElementById(labelId);
            input.addEventListener('change', function() {
              label.textContent = input.files.length ? input.files[0].name : 'Upload a File';
            });
          }
          updateFileLabel('unit-testing-file', 'unit-testing-file-label');
          updateFileLabel('security-posture-file', 'security-posture-file-label');
          updateFileLabel('regression-risk-file', 'regression-risk-file-label');
          updateFileLabel('semantic-bug-detection-file', 'semantic-bug-detection-file-label');
        </script>
        <script type="module" src="./index.js"></script>
        <script type="module" src="./ui.js"></script>
        <script type="module">
          import { showHeatmapIfNeeded } from './uiHelpers.js';
          showHeatmapIfNeeded();
        </script>
  </body>
</html>
