<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Angular Audit</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/zero-md@3?register"></script>
  <link rel="stylesheet" href="./app-theme.css" />
</head>

<body>
  <div class="header-nav-row">
    <header>Angular Audit</header>
    <nav aria-label="Analysis sections">
      <button id="code-coverage" class="active" aria-label="View Code Coverage analysis" aria-pressed="true" role="tab">
        Code Coverage
      </button>
      <button id="test-smells" aria-label="View Test Smells analysis" aria-pressed="false" role="tab">
        Test Smells
      </button>
      <button id="security-posture" aria-label="View Security Posture analysis" aria-pressed="false" role="tab">
        Security Posture
      </button>
      <button id="regression-risk" aria-label="View Regression Risk analysis" aria-pressed="false" role="tab">
        Regression Risk
      </button>
      <button id="semantic-bug-detection" aria-label="View Semantic Bug Detection analysis" aria-pressed="false"
        role="tab">
        Semantic Bug Detection
      </button>
    </nav>
  </div>
  <main>
    <div id="summary-md-container">
      <zero-md id="summary-md" style="display: block" src="">
        <template>
          <link rel="stylesheet" href="./app-theme.css" />
        </template>
      </zero-md>
    </div>
    <div class="chart-area" id="chart-area">
      <div id="file-upload-area">
        <div class="file-upload-group" id="code-coverage-upload" style="display: none; align-items: center; gap: 0.3rem">
          <label for="code-coverage-file" style="
                font-size: 0.98rem;
                color: #60a5fa;
                font-weight: 500;
                margin-bottom: 0;
              ">CSV code coverage:</label>
          <input type="file" id="code-coverage-file" accept=".csv" aria-label="Upload CSV for code coverage"
            style="display: none" />
          <button type="button" class="file-upload-btn" onclick="document.getElementById('code-coverage-file').click()"
            aria-label="Select CSV for code coverage">
            <span class="file-upload-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"
                style="vertical-align: middle">
                <rect x="3" y="14" width="14" height="3" rx="1.5" fill="#374151" />
                <path d="M10 14V5" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M7 8l3-3 3 3" stroke="#60a5fa" stroke-width="2" stroke-linecap="round"
                  stroke-linejoin="round" />
              </svg>
            </span>
            <span id="code-coverage-file-label">Upload a File</span>
          </button>
          <button id="code-coverage-advanced-btn" class="advanced-btn"
            aria-label="Show advanced chart options for code coverage" tabindex="0">
            Advanced options
          </button>
          <select id="code-coverage-chart-type" aria-label="Chart type for code coverage" style="display: none"></select>
        </div>
        <div class="file-upload-group" id="test-smells-upload" style="display: none; align-items: center; gap: 0.3rem">
          <label for="test-smells-file" style="
                font-size: 0.98rem;
                color: #60a5fa;
                font-weight: 500;
                margin-bottom: 0;
              ">CSV test smells:</label>
          <input type="file" id="test-smells-file" accept=".csv" aria-label="Upload CSV for test smells"
            style="display: none" />
          <button type="button" class="file-upload-btn" onclick="document.getElementById('test-smells-file').click()"
            aria-label="Select CSV for test smells">
            <span class="file-upload-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"
                style="vertical-align: middle">
                <rect x="3" y="14" width="14" height="3" rx="1.5" fill="#374151" />
                <path d="M10 14V5" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M7 8l3-3 3 3" stroke="#60a5fa" stroke-width="2" stroke-linecap="round"
                  stroke-linejoin="round" />
              </svg>
            </span>
            <span id="test-smells-file-label">Upload a File</span>
          </button>
          <button id="test-smells-advanced-btn" class="advanced-btn"
            aria-label="Show advanced chart options for test smells" tabindex="0">
            Advanced options
          </button>
          <select id="test-smells-chart-type" aria-label="Chart type for test smells" style="display: none"></select>
        </div>
        <div class="file-upload-group" id="security-posture-upload"
          style="display: none; align-items: center; gap: 0.3rem">
          <label for="security-posture-file" style="
                font-size: 0.98rem;
                color: #60a5fa;
                font-weight: 500;
                margin-bottom: 0;
              ">CSV Security Posture:</label>
          <input type="file" id="security-posture-file" accept=".csv" aria-label="Upload CSV for Security Posture"
            style="display: none" />
          <button type="button" class="file-upload-btn"
            onclick="document.getElementById('security-posture-file').click()"
            aria-label="Select CSV for Security Posture">
            <span class="file-upload-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"
                style="vertical-align: middle">
                <rect x="3" y="14" width="14" height="3" rx="1.5" fill="#374151" />
                <path d="M10 14V5" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M7 8l3-3 3 3" stroke="#60a5fa" stroke-width="2" stroke-linecap="round"
                  stroke-linejoin="round" />
              </svg>
            </span>
            <span id="security-posture-file-label">Upload a File</span>
          </button>
          <button id="security-posture-advanced-btn" class="advanced-btn"
            aria-label="Show advanced chart options for Security Posture" tabindex="0">
            Advanced options
          </button>
          <select id="security-posture-chart-type" aria-label="Chart type for Security Posture"
            style="display: none"></select>
        </div>
        <div class="file-upload-group" id="semantic-bug-detection-upload"
          style="display: none; align-items: center; gap: 0.3rem">
          <label for="semantic-bug-detection-file" style="
                font-size: 0.98rem;
                color: #60a5fa;
                font-weight: 500;
                margin-bottom: 0;
              ">CSV Semantic Bug Detection:</label>
          <input type="file" id="semantic-bug-detection-file" accept=".csv"
            aria-label="Upload CSV for Semantic Bug Detection" style="display: none" />
          <button type="button" class="file-upload-btn"
            onclick="document.getElementById('semantic-bug-detection-file').click()"
            aria-label="Select CSV for Semantic Bug Detection">
            <span class="file-upload-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"
                style="vertical-align: middle">
                <rect x="3" y="14" width="14" height="3" rx="1.5" fill="#374151" />
                <path d="M10 14V5" stroke="#60a5fa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M7 8l3-3 3 3" stroke="#60a5fa" stroke-width="2" stroke-linecap="round"
                  stroke-linejoin="round" />
              </svg>
            </span>
            <span id="semantic-bug-detection-file-label">Upload a File</span>
          </button>
          <button id="semantic-bug-detection-advanced-btn" class="advanced-btn"
            aria-label="Show advanced chart options for Semantic Bug Detection" tabindex="0">
            Advanced options
          </button>
          <select id="semantic-bug-detection-chart-type" aria-label="Chart type for Semantic Bug Detection"
            style="display: none"></select>
        </div>
      </div>
      <svg id="chart" style="width: 100%; height: 100%; position: static; z-index: 1" role="img"
        aria-label="Data chart"></svg>
      <div id="heatmap-container" style="width: 100%; height: auto; display: none"></div>
      <div class="loader" id="loader" aria-live="polite" aria-label="Loading data"></div>
      <div id="csv-summary" style="
            display: none;
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: #222;
            color: #fff;
            padding: 1rem 1.5rem;
            border-radius: 0.7rem;
            z-index: 300;
            box-shadow: 0 2px 12px #0008;
            font-size: 1.05rem;
          "></div>
      <div class="error-message" id="error-message" aria-live="polite" hidden></div>
    </div>
  </main>
  <script>
    function updateFileLabel(inputId, labelId) {
      const input = document.getElementById(inputId);
      const label = document.getElementById(labelId);
      input.addEventListener("change", function () {
        label.textContent = input.files.length
          ? input.files[0].name
          : "Upload a File";
      });
    }
  updateFileLabel("code-coverage-file", "code-coverage-file-label");
  updateFileLabel("test-smells-file", "test-smells-file-label");
    updateFileLabel("security-posture-file", "security-posture-file-label");
    updateFileLabel(
      "semantic-bug-detection-file",
      "semantic-bug-detection-file-label"
    );
  </script>
  <script type="module" src="./index.js"></script>
  <script type="module" src="./ui.js"></script>
  <script type="module">
    import {
      showHeatmapIfNeeded,
      renderCommitsBarCharts,
      hideCommitsBarCharts,
      renderHeatmap,
      hideHeatmap
    } from './uiHelpers.js';
    showHeatmapIfNeeded();
  </script>
</body>

</html>